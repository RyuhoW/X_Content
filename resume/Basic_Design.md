# X.com コンテンツジェネレーター基本設計書

**文書番号:** XCG-BSD-2025-001  
**バージョン:** 1.0.0  
**作成日:** 2025-04-28  
**最終更新日:** 2025-04-28  
**作成者:** RyuhoW  
**レビュアー:** {レビュアー名}  
**ステータス:** ドラフト

## 変更履歴

| 日付 | バージョン | 担当者 | 変更内容 |
|------|------------|---------|----------|
| 2025-04-28 | 1.0.0 | RyuhoW | 初版作成 |

## 目次

1. [システム概要](#1-システム概要)
2. [システムアーキテクチャ](#2-システムアーキテクチャ)
3. [機能設計](#3-機能設計)
4. [データモデル設計](#4-データモデル設計)
5. [画面設計](#5-画面設計)
6. [外部システム連携設計](#6-外部システム連携設計)
7. [セキュリティ設計](#7-セキュリティ設計)
8. [性能設計](#8-性能設計)
9. [運用設計](#9-運用設計)
10. [開発環境・言語・フレームワーク](#10-開発環境言語フレームワーク)
11. [付録](#11-付録)

## 1. システム概要

### 1.1 目的と背景

X.com コンテンツジェネレーターは、X.com（旧Twitter）へのコンテンツ作成と投稿管理を効率化するデスクトップアプリケーションである。本システムによって、ユーザーは質の高いコンテンツを定期的に生成し、最適なタイミングで投稿し、そのパフォーマンスを分析することが可能になる。

昨今のデジタルマーケティング環境において、X.comのようなソーシャルメディアでのプレゼンスは企業や個人にとって重要な要素となっている。しかし、質の高いコンテンツを継続的に生成することや、複数アカウントの管理、最適な投稿タイミングの把握などは多くのリソースを必要とする課題である。本システムはこれらの課題を解決し、効率的なソーシャルメディア運用を支援する。

### 1.2 システム全体像

X.com コンテンツジェネレーターは、以下の主要コンポーネントから構成される：

1. **フロントエンド**：JavaFXベースのGUIアプリケーション
2. **バックエンド**：Java言語で実装されるビジネスロジック層
3. **ローカルデータストア**：SQLiteを使用したローカルデータベース
4. **外部連携モジュール**：X.com API、Stripe API等との連携モジュール

システムは主にデスクトップアプリケーションとして機能し、すべての基本処理をローカルで実行する。ただし、X.comへの投稿やStripeでの支払い処理など一部機能は外部APIs連携に依存する。

### 1.3 関連文書

- [XCG-REQ-2025-001] X.comコンテンツジェネレーター要件定義書
- [XCG-ARCH-2025-001] X.comコンテンツジェネレーターアーキテクチャ設計書
- [XCG-PRJ-2025-001] X.comコンテンツジェネレータープロジェクト計画書
- [XCG-TEST-2025-001] X.comコンテンツジェネレーターテスト計画書

## 2. システムアーキテクチャ

### 2.1 論理アーキテクチャ

本システムは、以下の論理レイヤーで構成される：

1. **プレゼンテーション層（Presentation Layer）**
   - ユーザーインターフェース
   - 画面コントローラー
   - データバインディング

2. **アプリケーション層（Application Layer）**
   - ビジネスロジック
   - ワークフロー管理
   - セッション管理

3. **ドメイン層（Domain Layer）**
   - ドメインモデル
   - ドメインサービス
   - バリデーションルール

4. **データアクセス層（Data Access Layer）**
   - データリポジトリ
   - データマッピング
   - キャッシュ管理

5. **インフラストラクチャ層（Infrastructure Layer）**
   - 外部API連携
   - ストレージアクセス
   - セキュリティサービス

``plantuml
@startuml
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Container.puml

Person(user, "ユーザー", "アプリケーションを使用して\nX.comコンテンツを管理")

System_Boundary(c1, "X.comコンテンツジェネレーター") {
  Container(desktop_app, "デスクトップアプリケーション", "JavaFX", "ユーザーインターフェース\nおよびクライアント側処理")
  Container(business_logic, "ビジネスロジック", "Java", "コアアプリケーション\nロジック")
  ContainerDb(local_db, "ローカルデータベース", "SQLite", "コンテンツ、設定、\nアカウント情報を保存")
}

System_Ext(x_api, "X.com API", "X.comへの投稿および\nアナリティクス取得")
System_Ext(stripe_api, "Stripe API", "サブスクリプション管理\n支払い処理")

Rel(user, desktop_app, "使用する")
Rel(desktop_app, business_logic, "呼び出す")
Rel(business_logic, local_db, "読み書きする")
Rel(business_logic, x_api, "投稿・データ取得")
Rel(business_logic, stripe_api, "支払い処理・サブスクリプション管理")

@enduml
``

### 2.2 物理アーキテクチャ

本システムはクライアントサイドのデスクトップアプリケーションであり、以下のコンポーネントで構成される：

1. **デスクトップアプリケーション**
   - ユーザーのローカルPC上で動作
   - OS: Windows、macOS、Linux

2. **ローカルデータベース**
   - SQLiteデータベース
   - アプリケーションと同一プロセス内

3. **外部システム（クラウドサービス）**
   - X.com API
   - Stripe API

``plantuml
@startuml
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Deployment.puml

Deployment_Node(client, "クライアントPC", "Windows/macOS/Linux") {
  Container(app, "X.comコンテンツジェネレーター", "JavaFX Application")
  ContainerDb(sqlite, "SQLite DB", "データ保存")
}

Deployment_Node(cloud, "クラウドサービス", "インターネット") {
  System_Ext(x_servers, "X.com API", "REST API")
  System_Ext(stripe_servers, "Stripe API", "REST API")
}

Rel(app, sqlite, "読み書き")
Rel(app, x_servers, "API呼び出し", "HTTPS")
Rel(app, stripe_servers, "API呼び出し", "HTTPS")

@enduml
``

### 2.3 ソフトウェアコンポーネント構成

本システムのソフトウェアコンポーネントは以下の通り構成される：

1. **UIコンポーネント**
   - メイン画面管理
   - コンテンツエディタ
   - スケジューラーUI
   - アナリティクスビュー
   - 設定・管理画面

2. **コアエンジン**
   - コンテンツジェネレーションエンジン
   - テキスト分析・最適化エンジン
   - スケジューリングエンジン
   - アナリティクスエンジン

3. **外部連携モジュール**
   - X.com APIクライアント
   - Stripe APIクライアント
   - OAuth認証マネージャ

4. **データ管理モジュール**
   - SQLiteデータベースマネージャ
   - モデル・リポジトリ
   - キャッシュマネージャ

5. **ユーティリティ・共通モジュール**
   - ロギングユーティリティ
   - 暗号化ユーティリティ
   - エラーハンドリング
   - 設定マネージャ

``plantuml
@startuml
package "X.comコンテンツジェネレーター" {
  package "UIコンポーネント" {
    [メイン画面]
    [コンテンツエディタ]
    [スケジューラーUI]
    [アナリティクスビュー]
    [設定画面]
  }
  
  package "コアエンジン" {
    [コンテンツ生成エンジン]
    [テキスト分析エンジン]
    [スケジューリングエンジン]
    [アナリティクスエンジン]
  }
  
  package "外部連携" {
    [X.com APIクライアント]
    [Stripe APIクライアント]
    [OAuth認証マネージャ]
  }
  
  package "データ管理" {
    [データベースマネージャ]
    [モデルリポジトリ]
    [キャッシュマネージャ]
  }
  
  package "ユーティリティ" {
    [ロギング]
    [暗号化]
    [エラーハンドリング]
    [設定管理]
  }
  
  database "SQLite" {
    folder "テーブル" {
      [コンテンツ]
      [アカウント]
      [スケジュール]
      [アナリティクス]
      [設定]
    }
  }
}

[メイン画面] --> [コンテンツエディタ]
[メイン画面] --> [スケジューラーUI]
[メイン画面] --> [アナリティクスビュー]
[メイン画面] --> [設定画面]

[コンテンツエディタ] --> [コンテンツ生成エンジン]
[スケジューラーUI] --> [スケジューリングエンジン]
[アナリティクスビュー] --> [アナリティクスエンジン]

[コンテンツ生成エンジン] --> [テキスト分析エンジン]
[コンテンツ生成エンジン] --> [モデルリポジトリ]
[スケジューリングエンジン] --> [モデルリポジトリ]
[アナリティクスエンジン] --> [モデルリポジトリ]

[モデルリポジトリ] --> [データベースマネージャ]
[キャッシュマネージャ] --> [データベースマネージャ]
[データベースマネージャ] --> [SQLite]

[X.com APIクライアント] --> [OAuth認証マネージャ]
[スケジューリングエンジン] --> [X.com APIクライアント]
[アナリティクスエンジン] --> [X.com APIクライアント]
[設定画面] --> [Stripe APIクライアント]

@enduml
``

## 3. 機能設計

### 3.1 コンテンツ生成機能

#### 3.1.1 テンプレートベースのコンテンツ生成

**概要:**
ユーザーが選択したテンプレートに基づいて、X.com投稿コンテンツを自動生成する機能。

**処理フロー:**

1. ユーザーがテンプレートカテゴリを選択
2. システムが選択されたカテゴリのテンプレート一覧を表示
3. ユーザーがテンプレートを選択
4. ユーザーがキーワードや必要なパラメータを入力
5. システムがテンプレートと入力パラメータに基づいてコンテンツを生成
6. 生成結果をプレビューとして表示
7. ユーザーが必要に応じて編集
8. 最終コンテンツの確定

**テンプレート種類:**
- 質問形式
- ニュース共有形式
- 引用形式
- プロモーション形式
- ハウツー形式
- アンケート形式
- スレッド形式

**ライセンス別制限:**
- Beginner: 基本テンプレート10種類のみ
- Amateur: 基本＋中級テンプレート合計20種類
- Professional以上: すべてのテンプレート(40種類以上)

**カスタムテンプレート機能:**
- ユーザー独自のテンプレート作成と保存
- 変数プレースホルダーの定義
- テンプレートのカテゴリ分け
- テンプレートのインポート・エクスポート

#### 3.1.2 AIによるコンテンツ最適化

**概要:**
生成されたコンテンツをAIによって分析・最適化し、エンゲージメント向上を図る機能。

**処理フロー:**

1. ユーザーがコンテンツ最適化ボタンをクリック
2. システムがテキスト分析エンジンを起動
3. 内容を分析（言語、トーン、長さ、キーワード密度など）
4. エンゲージメント向上のためのアドバイスを生成
5. 推奨される修正案を表示
6. ユーザーが修正を適用するか選択

**最適化機能:**
- 文章の簡潔化
- エンゲージメントを高める表現への変換
- 文法・スペルチェック
- 長さ最適化（文字数制限内での調整）
- アクションを促す表現の提案
- トーンの調整（フォーマル/カジュアル）

**ライセンス別制限:**
- Beginner: 基本的な文法・スペルチェックのみ
- Amateur: 基本最適化機能
- Professional: 詳細な最適化と分析
- Black: AIによる高度なコンテンツ最適化

#### 3.1.3 ハッシュタグ推奨

**概要:**
投稿内容に適したハッシュタグを自動推奨し、リーチとエンゲージメントを向上させる機能。

**処理フロー:**

1. コンテンツ生成/編集完了後、ハッシュタグ推奨ボタンをクリック
2. システムがコンテンツを分析
3. 関連性の高いハッシュタグを抽出
4. トレンドハッシュタグと照合
5. 効果予測スコア付きでハッシュタグを推奨
6. ユーザーが採用するハッシュタグを選択

**ハッシュタグ推奨基準:**
- コンテンツとの関連性
- 現在のトレンド状況
- 過去のパフォーマンス履歴
- アカウントのフォロワー傾向

**カスタムハッシュタグセット:**
- ユーザー定義のハッシュタグセットの作成と管理
- 頻繁に使うハッシュタグのお気に入り登録
- ハッシュタグパフォーマンスの追跡

### 3.2 スケジューリング機能

#### 3.2.1 投稿スケジュール管理

**概要:**
複数の投稿を事前に作成し、指定した日時に自動投稿するスケジュール管理機能。

**処理フロー:**

1. ユーザーが投稿内容を作成/編集
2. スケジュール設定画面でスケジュール日時を指定
3. システムがスケジュール情報をデータベースに保存
4. バックグラウンドスケジューラーが定期的にスケジュールをチェック
5. スケジュール時刻になると自動的に投稿を実行
6. 投稿結果をログに記録し、必要に応じて通知

**スケジュール設定オプション:**
- 単発スケジュール
- 繰り返しスケジュール（毎日、毎週、毎月）
- スケジュールのプレビューとカレンダー表示
- ドラッグ＆ドロップによるスケジュール調整

**ライセンス別制限:**
- Beginner: スケジュール機能なし（手動投稿のみ）
- Amateur: 週3回までのスケジュール投稿
- Professional以上: 無制限のスケジュール投稿

#### 3.2.2 最適投稿時間推奨

**概要:**
過去のエンゲージメントデータとフォロワーのアクティブ時間に基づいて、最適な投稿時間を推奨する機能。

**処理フロー:**

1. システムが過去の投稿データを分析
2. 時間帯別のエンゲージメント率を計算
3. フォロワーのアクティブ時間データを分析
4. 曜日と時間に基づく最適投稿時間マップを生成
5. スケジュール設定時に最適時間を推奨
6. ユーザーが採用するか決定

**分析指標:**
- 時間帯別の平均インプレッション数
- 時間帯別のエンゲージメント率
- フォロワーのアクティブ傾向
- 業界別ベストプラクティス

**ライセンス別制限:**
- Beginner: 機能なし
- Amateur: 基本的な推奨（一般的な傾向に基づく）
- Professional以上: アカウント固有の詳細分析に基づく推奨

### 3.3 分析機能

#### 3.3.1 投稿パフォーマンス分析

**概要:**
投稿のパフォーマンスを多角的に分析し、視覚化するダッシュボード機能。

**処理フロー:**

1. ユーザーが分析対象の投稿または期間を選択
2. システムがX.com APIから詳細なエンゲージメントデータを取得
3. 各種指標に基づいてデータを分析
4. グラフやチャートで可視化
5. パフォーマンス向上のための推奨事項を生成

**分析指標:**
- いいね数、リポスト数、返信数
- インプレッション数とリーチ数
- エンゲージメント率（エンゲージメント/インプレッション）
- クリックスルー率（リンクがある場合）
- フォロワー獲得数
- ハッシュタグ効果分析

**ビジュアライゼーション:**
- 時系列グラフ
- バブルチャート（内容タイプ別）
- ヒートマップ（時間帯別効果）
- 比較分析（過去投稿との比較）

**ライセンス別制限:**
- Beginner: 基本的な統計のみ
- Amateur: 標準分析機能
- Professional: 詳細分析と推奨
- Black: AIによる高度な予測と分析

#### 3.3.2 アカウント成長分析

**概要:**
アカウントの成長傾向を分析し、フォロワー獲得の要因やパターンを特定する機能。

**処理フロー:**

1. ユーザーがアカウント分析ページにアクセス
2. システムがアカウント関連データを取得・分析
3. 成長指標とグラフを生成
4. 成長要因の分析結果を表示
5. 改善のための推奨事項を提示

**分析指標:**
- フォロワー数の推移
- フォロワー獲得率と離脱率
- プロフィール訪問数
- メンション数
- 投稿タイプ別の効果
- トップパフォーマンス投稿分析

**ライセンス別制限:**
- Beginner: 基本的なフォロワー統計のみ
- Amateur: 標準成長分析
- Professional以上: 詳細な要因分析と推奨

### 3.4 アカウント管理機能

#### 3.4.1 マルチアカウント管理

**概要:**
複数のX.comアカウントを一元管理し、切り替えながら操作できる機能。

**処理フロー:**

1. ユーザーがアカウント追加を選択
2. OAuth認証フローでX.comアカウント連携
3. 認証トークンを安全に暗号化保存
4. アカウント一覧に追加・表示
5. アカウント切り替えでセッション変更
6. アカウントごとの設定と権限管理

**アカウント情報管理:**
- 基本プロフィール情報
- 認証トークン（暗号化保存）
- アカウント固有の設定
- アカウントグループ化

**ライセンス別制限:**
- Beginner: 1アカウントのみ
- Amateur: 最大3アカウント
- Professional以上: 無制限アカウント

#### 3.4.2 フォロワー分析

**概要:**
フォロワーの属性や行動パターンを分析し、効果的なコンテンツ戦略の策定を支援する機能。

**処理フロー:**

1. ユーザーがフォロワー分析ページにアクセス
2. システムがフォロワーデータをX.com APIから取得
3. フォロワープロファイルの集計と分析
4. インサイトとビジュアライゼーションの生成

**分析指標:**
- フォロワーの活動時間帯分布
- インフルエンサー識別
- エンゲージメント活性度による分類
- フォロワー同士の関係性マップ

**ライセンス別制限:**
- Beginner: 機能なし
- Amateur: 基本的なフォロワー統計
- Professional以上: 高度なフォロワー分析

### 3.5 サブスクリプション・決済機能

#### 3.5.1 ライセンス管理

**概要:**
ユーザーのサブスクリプションプランを管理し、機能制限を制御する機能。

**処理フロー:**

1. ユーザーがプラン選択・変更を実施
2. Stripe APIを使用して支払い処理
3. サブスクリプション情報を取得・保存
4. ライセンス状態に基づいて機能アクセス制御
5. 期限切れ/更新時の通知

**ライセンスチェック:**
- アプリ起動時の自動ライセンス検証
- 機能アクセス時のライセンスレベル確認
- オンライン/オフライン検証メカニズム
- トライアルライセンス管理

**サブスクリプションプラン:**
- Beginner（無料）
- Amateur（月額980円）
- Professional（月額2,980円）
- Black（月額9,800円）

#### 3.5.2 Stripe決済連携

**概要:**
Stripe APIと連携し、安全かつ効率的な決済処理とサブスクリプション管理を実現する機能。

**処理フロー:**

1. ユーザーが課金プランを選択
2. Stripe Checkoutセッション作成
3. ユーザーをブラウザでStripe決済ページに誘導
4. 決済完了後、Stripeからコールバック受信
5. サブスクリプション状態の更新
6. ライセンスのアクティベーション

**決済管理機能:**
- クレジットカード決済
- サブスクリプションの管理（支払い履歴、更新、キャンセル）
- 請求書の生成と表示
- 支払い通知

**技術的実装:**
- Stripe API v2023-10-16以降を使用
- Webhook対応（支払いイベント処理）
- 顧客情報の安全な管理（PCI DSS対応）
- 決済エラー処理

## 4. データモデル設計

### 4.1 エンティティ関連図（ERD）

本システムのデータモデルをエンティティ関連図で示す。

``plantuml
@startuml
entity "User" as user {
  *userId : INTEGER
  --
  *username : TEXT
  *email : TEXT
  *encryptedPassword : TEXT
  *licenseType : TEXT
  *subscriptionPlan : TEXT
  *subscriptionExpiryDate : DATETIME
  stripeCustomerId : TEXT
  createdAt : DATETIME
  updatedAt : DATETIME
}

entity "Account" as account {
  *accountId : INTEGER
  --
  *userId : INTEGER <<FK>>
  *username : TEXT
  *displayName : TEXT
  *authToken : TEXT
  *authTokenSecret : TEXT
  profileImageUrl : TEXT
  isDefault : BOOLEAN
  isActive : BOOLEAN
  createdAt : DATETIME
  updatedAt : DATETIME
}

entity "Content" as content {
  *contentId : INTEGER
  --
  *accountId : INTEGER <<FK>>
  *text : TEXT
  hashtags : TEXT
  mediaUrls : TEXT
  templateId : INTEGER <<FK>>
  status : TEXT
  createdAt : DATETIME
  updatedAt : DATETIME
}

entity "Schedule" as schedule {
  *scheduleId : INTEGER
  --
  *contentId : INTEGER <<FK>>
  *scheduledTime : DATETIME
  scheduledStatus : TEXT
  isRecurring : BOOLEAN
  recurrencePattern : TEXT
  createdAt : DATETIME
  updatedAt : DATETIME
}

entity "Template" as template {
  *templateId : INTEGER
  --
  *userId : INTEGER <<FK>>
  *name : TEXT
  *category : TEXT
  *content : TEXT
  isDefault : BOOLEAN
  createdAt : DATETIME
  updatedAt : DATETIME
}

entity "Post" as post {
  *postId : INTEGER
  --
  *accountId : INTEGER <<FK>>
  *contentId : INTEGER <<FK>>
  *xPostId : TEXT
  postedAt : DATETIME
  createdAt : DATETIME
}

entity "Analytics" as analytics {
  *analyticsId : INTEGER
  --
  *postId : INTEGER <<FK>>
  *timestamp : DATETIME
  impressions : INTEGER
  likes : INTEGER
  replies : INTEGER
  reposts : INTEGER
  quotes : INTEGER
  profileClicks : INTEGER
  linkClicks : INTEGER
}

entity "Hashtag" as hashtag {
  *hashtagId : INTEGER
  --
  *tag : TEXT
  *userId : INTEGER <<FK>>
  category : TEXT
  usageCount : INTEGER
  lastUsed : DATETIME
}

entity "Subscription" as subscription {
  *subscriptionId : INTEGER
  --
  *userId : INTEGER <<FK>>
  *stripeSubscriptionId : TEXT
  *plan : TEXT
  *status : TEXT
  *startDate : DATETIME
  *endDate : DATETIME
  cancellationDate : DATETIME
  createdAt : DATETIME
  updatedAt : DATETIME
}

entity "PaymentHistory" as payment {
  *paymentId : INTEGER
  --
  *userId : INTEGER <<FK>>
  *stripePaymentId : TEXT
  *subscriptionId : INTEGER <<FK>>
  *amount : DECIMAL
  *currency : TEXT
  *status : TEXT
  *paymentDate : DATETIME
  receiptUrl : TEXT
  createdAt : DATETIME
}

user ||--o{ account : has
account ||--o{ content : creates
content ||--o{ schedule : scheduled via
content ||--o{ post : published as
post ||--o{ analytics : has
user ||--o{ template : owns
content }o--|| template : uses
user ||--o{ hashtag : saves
content }o--o{ hashtag : uses
user ||--o{ subscription : subscribes
subscription ||--o{ payment : has

@enduml
``

### 4.2 データベーススキーマ

#### 4.2.1 users テーブル

ユーザー情報を保存するテーブル。

| カラム名 | データ型 | 制約 | 説明 |
|----------|----------|------|------|
| userId | INTEGER | PRIMARY KEY, AUTOINCREMENT | ユーザー識別子 |
| username | TEXT | NOT NULL | ユーザー名 |
| email | TEXT | NOT NULL, UNIQUE | メールアドレス |
| encryptedPassword | TEXT | NOT NULL | 暗号化されたパスワード |
| licenseType | TEXT | NOT NULL | ライセンスタイプ |
| subscriptionPlan | TEXT | NOT NULL | サブスクリプションプラン |
| subscriptionExpiryDate | DATETIME | NOT NULL | サブスクリプション期限 |
| stripeCustomerId | TEXT | | Stripe顧客ID |
| createdAt | DATETIME | DEFAULT CURRENT_TIMESTAMP | 作成日時 |
| updatedAt | DATETIME | DEFAULT CURRENT_TIMESTAMP | 更新日時 |

#### 4.2.2 accounts テーブル

X.comのアカウント情報を保存するテーブル。

| カラム名 | データ型 | 制約 | 説明 |
|----------|----------|------|------|
| accountId | INTEGER | PRIMARY KEY, AUTOINCREMENT | アカウント識別子 |
| userId | INTEGER | NOT NULL, FOREIGN KEY | 所有ユーザーID |
| username | TEXT | NOT NULL | X.comのユーザー名 |
| displayName | TEXT | NOT NULL | 表示名 |
| authToken | TEXT | NOT NULL | 認証トークン(暗号化) |
| authTokenSecret | TEXT | NOT NULL | 認証トークンシークレット(暗号化) |
| profileImageUrl | TEXT | | プロフィール画像URL |
| isDefault | BOOLEAN | DEFAULT 0 | デフォルトアカウントか |
| isActive | BOOLEAN | DEFAULT 1 | アクティブか |
| createdAt | DATETIME | DEFAULT CURRENT_TIMESTAMP | 作成日時 |
| updatedAt | DATETIME | DEFAULT CURRENT_TIMESTAMP | 更新日時 |

#### 4.2.3 contents テーブル

作成されたコンテンツを保存するテーブル。

| カラム名 | データ型 | 制約 | 説明 |
|----------|----------|------|------|
| contentId | INTEGER | PRIMARY KEY, AUTOINCREMENT | コンテンツ識別子 |
| accountId | INTEGER | NOT NULL, FOREIGN KEY | 関連アカウントID |
| text | TEXT | NOT NULL | 投稿テキスト |
| hashtags | TEXT | | ハッシュタグ（カンマ区切り） |
| mediaUrls | TEXT | | メディアURL（カンマ区切り） |
| templateId | INTEGER | FOREIGN KEY | 使用テンプレートID |
| status | TEXT | NOT NULL | 状態（draft/published/scheduled） |
| createdAt | DATETIME | DEFAULT CURRENT_TIMESTAMP | 作成日時 |
| updatedAt | DATETIME | DEFAULT CURRENT_TIMESTAMP | 更新日時 |

### 4.3 データアクセス層設計

データアクセス層は、Repository パターンを採用して実装する。主要なリポジトリクラスは以下の通り：

1. **UserRepository**
   - ユーザー情報の永続化と取得
   - ライセンス情報の管理

2. **AccountRepository**
   - X.comアカウント情報の管理
   - 認証情報の安全な保存と取得

3. **ContentRepository**
   - コンテンツの保存と検索
   - ドラフトと公開コンテンツの管理

4. **ScheduleRepository**
   - スケジュール情報の管理
   - スケジュール検索と更新

5. **TemplateRepository**
   - テンプレートの保存と検索
   - カスタムテンプレートの管理

6. **PostRepository**
   - 投稿済みコンテンツの管理
   - X.com投稿IDとの紐付け

7. **AnalyticsRepository**
   - 分析データの蓄積と検索
   - 時系列データの管理

8. **HashtagRepository**
   - ハッシュタグ情報の保存と検索
   - パフォーマンス追跡

9. **SubscriptionRepository**
   - サブスクリプション情報の管理
   - Stripe連携データの保存

## 5. 画面設計

### 5.1 画面構成

本システムは以下の主要画面で構成される：

1. **メインダッシュボード**
   - アカウント概要
   - 最近の投稿パフォーマンス
   - スケジュール予定
   - クイックアクション

2. **コンテンツ生成・編集画面**
   - テンプレート選択
   - コンテンツエディタ
   - ハッシュタグ管理
   - メディア管理
   - プレビュー

3. **スケジュール管理画面**
   - カレンダービュー
   - リストビュー
   - スケジュール設定
   - 最適時間推奨

4. **分析ダッシュボード**
   - 投稿パフォーマンス
   - アカウント成長指標
   - エンゲージメント分析
   - フォロワー分析

5. **アカウント管理画面**
   - アカウント追加・編集
   - プロファイル表示
   - 権限設定

6. **設定画面**
   - 一般設定
   - 通知設定
   - バックアップ設定
   - ライセンス管理

7. **サブスクリプション管理画面**
   - プラン表示・変更
   - 支払い履歴
   - 請求情報管理

### 5.2 画面遷移図

画面間の遷移関係を示す遷移図。

``plantuml
@startuml
[*] --> ログイン
ログイン --> メインダッシュボード : 認証成功
ログイン --> サブスクリプション管理 : ライセンス切れ
ログイン --> [*] : キャンセル

メインダッシュボード --> コンテンツ生成
メインダッシュボード --> スケジュール管理
メインダッシュボード --> 分析ダッシュボード
メインダッシュボード --> アカウント管理
メインダッシュボード --> 設定
メインダッシュボード --> サブスクリプション管理

コンテンツ生成 --> テンプレート選択
テンプレート選択 --> コンテンツエディタ
コンテンツエディタ --> ハッシュタグ推奨
コンテンツエディタ --> メディア選択
コンテンツエディタ --> プレビュー
コンテンツエディタ --> AIコンテンツ最適化
AIコンテンツ最適化 --> コンテンツエディタ
プレビュー --> 投稿確認
プレビュー --> スケジュール設定
スケジュール設定 --> スケジュール管理
投稿確認 --> メインダッシュボード : 投稿完了

スケジュール管理 --> カレンダービュー
スケジュール管理 --> リストビュー
カレンダービュー --> スケジュール設定 : 日時選択
リストビュー --> スケジュール設定 : 予定選択
スケジュール設定 --> 最適時間推奨
最適時間推奨 --> スケジュール設定
スケジュール設定 --> メインダッシュボード : 設定完了

分析ダッシュボード --> 投稿分析詳細
分析ダッシュボード --> アカウント成長分析
分析ダッシュボード --> フォロワー分析
分析ダッシュボード --> ハッシュタグ分析
投稿分析詳細 --> コンテンツ生成 : 類似投稿作成

アカウント管理 --> アカウント追加
アカウント管理 --> アカウント編集
アカウント管理 --> アカウント削除確認
アカウント追加 --> OAuth認証 : X.com連携
OAuth認証 --> アカウント管理 : 連携完了

設定 --> 一般設定
設定 --> 通知設定
設定 --> バックアップ/復元
設定 --> 外観設定

サブスクリプション管理 --> プラン選択
サブスクリプション管理 --> 支払い履歴
サブスクリプション管理 --> 請求情報編集
プラン選択 --> Stripe決済 : プラン変更
Stripe決済 --> サブスクリプション管理 : 支払い完了

@enduml
``

### 5.3 主要画面ワイヤーフレーム

#### 5.3.1 メインダッシュボード

メインダッシュボード画面のワイヤーフレーム：

``plantuml
@startsalt
{
  {
    <b>X.com コンテンツジェネレーター | ダッシュボード
  }
  {
    {
      {T
       + アカウント切替▼
       ++ @testuser
       ++ @company_official
      }
    } | {
      [新規コンテンツ作成] | [スケジュール管理] | [分析レポート] | [設定]
    }
  }
  {
    {
      <b>アカウント概要 | @testuser
      ^フォロワー数^今週の増減^エンゲージメント率^
      |1,234|+16|4.5%|
      
      <b>最近の投稿パフォーマンス
      {#
      ^内容^投稿日時^いいね^リポスト^
      |テストツイート1...|2025/04/25 12:00|24|7|
      |新機能のお知らせ...|2025/04/23 18:30|56|12|
      |質問：みなさんは...|2025/04/21 09:15|32|3|
      }
    } | {
      <b>今後の予定投稿
      {#
      ^内容^予定日時^
      |週末キャンペーン...|2025/04/30 10:00|
      |新商品紹介...|2025/05/02 14:00|
      |アンケート...|2025/05/05 18:00|
      }
      
      <b>アクティビティサマリー
      {
        [最適投稿時間▼]
        {
          "<color:blue>月</color>" "<color:blue>火</color>" "<color:blue>水</color>" "<color:blue>木</color>" "<color:blue>金</color>" "<color:red>土</color>" "<color:red>日</color>"
        }
        {
          " . " " # " " # " " . " " # " " # " " . "
          " . " " . " " # " " # " " . " " # " " . "
          " # " " . " " . " " . " " . " " # " " # "
          " # " " . " " . " " # " " # " " . " " # "
        }
        <color:gray>濃い色ほど高エンゲージメント</color>
      }
    }
  }
  {
    <b>クイックアクセス
    [テンプレートから作成] | [スケジュール一括登録] | [分析レポート作成]
  }
  {
    サブスクリプション: Professional | 有効期限: 2025/12/31 | [アップグレード]
  }
}
@endsalt
``

#### 5.3.2 コンテンツ生成画面

コンテンツ生成・編集画面のワイヤーフレーム：

``plantuml
@startsalt
{
  {
    <b>X.com コンテンツジェネレーター | コンテンツ生成
  }
  {
    [戻る] | {
      選択アカウント: @testuser
    } | {
      テンプレート: (X) 質問形式 () 引用形式 () ニュース形式 () プロモーション形式 () カスタム
    }
  }
  {
    {
      <b>キーワード入力
      {
        プライマリキーワード | "ソーシャルメディア"
      }
      {
        セカンダリキーワード | "マーケティング" | [+]
      }
      キーワードリスト:
      {#
      ^キーワード^アクション^
      |ブランディング|[削除]|
      |SNS戦略|[削除]|
      |エンゲージメント|[削除]|
      }
      [キーワード候補を表示]
    } | {
      <b>コンテンツエディタ
      {
        {
          {INPUT
            ソーシャルメディアマーケティングで最も重要な指標は何だと思いますか？

            私は最近、エンゲージメント率を重視していますが、皆さんの意見を聞かせてください。

            #質問 #マーケティング #SNS
          }
        }
        文字数: 86/280 | [AI最適化] | [バリエーション生成]
      }
      
      <b>ハッシュタグ
      {
        {
          <tag:#質問> <tag:#マーケティング> <tag:#SNS> <tag:#ソーシャルメディア>
        }
        {
          新規ハッシュタグ | "ブランディング" | [追加]
        }
        [ハッシュタグ候補を表示]
      }
      
      <b>エンゲージメント予測
      {
        予測いいね数: 25-35
        予測リポスト数: 5-10
        最適投稿時間帯: 18:00-20:00
        エンゲージメントスコア: 7.5/10
      }
    }
  }
  {
    [下書き保存] | [投稿プレビュー] | [スケジュール設定...] | [今すぐ投稿]
  }
}
@endsalt
``

## 6. 外部システム連携設計

### 6.1 X.com API連携設計

本システムはX.com API v2.0を使用して投稿、分析、アカウント管理機能を実現する。

#### 6.1.1 OAuth認証フロー

X.com APIへのアクセスに必要なOAuth認証フローを実装する。

**認証フロー:**

1. アプリケーションがリクエストトークンを取得
2. ユーザーをブラウザでX.com認証ページに誘導
3. ユーザーがアプリへのアクセスを許可
4. コールバックでアクセストークンを取得
5. アクセストークンを安全に暗号化して保存

**技術実装:**
- OAuth 1.0a プロトコル
- PIN方式認証（必要に応じて）
- トークンのセキュアストレージ

#### 6.1.2 投稿API連携

X.com APIを使った投稿処理の実装詳細。

**主要API呼び出し:**
- `POST /2/tweets` - 新規投稿作成
- `POST /2/tweets/:id/retweet` - リポスト
- `DELETE /2/tweets/:id` - 投稿削除

**メディアアップロードAPI:**
- `POST /1.1/media/upload.json` (バイナリアップロード)
- チャンクアップロード処理（大きなメディアファイル用）

**レート制限対応:**
- API制限の監視とキャッシュ
- 429 Too Many Requestsレスポンス対応
- 指数バックオフによる再試行

#### 6.1.3 分析API連携

X.com APIからアナリティクスデータを取得する実装。

**主要API呼び出し:**
- `GET /2/tweets/:id` - 投稿詳細取得
- `GET /2/users/:id/tweets` - ユーザー投稿一覧
- `GET /2/tweets/counts/recent` - 最近の投稿カウント
- `GET /2/users/:id/followers` - フォロワーデータ取得

**データ集計処理:**
- ポーリングによる定期的なデータ更新
- 増分データ取得と差分計算
- ローカルデータベースへの蓄積

### 6.2 Stripe API連携設計

本システムはStripe APIを使用して、サブスクリプションと決済処理を実現する。

#### 6.2.1 サブスクリプション管理

Stripeを利用したサブスクリプション管理の実装詳細。

**主要API呼び出し:**
- `POST /v1/customers` - 顧客情報登録
- `POST /v1/subscriptions` - サブスクリプション作成
- `GET /v1/subscriptions/:id` - サブスクリプション情報取得
- `PATCH /v1/subscriptions/:id` - サブスクリプション更新

**サブスクリプションライフサイクル管理:**
- 新規サブスクリプション作成
- プラン変更処理
- 更新・キャンセル処理
- サブスクリプション有効期限管理

#### 6.2.2 支払い処理

Stripeを利用した決済処理の実装詳細。

**主要API呼び出し:**
- `POST /v1/checkout/sessions` - チェックアウトセッション作成
- `GET /v1/checkout/sessions/:id` - セッション状態確認
- `GET /v1/payment_intents/:id` - 支払い状態確認

**決済フロー:**
1. チェックアウトセッション作成
2. ユーザーをStripeホストのチェックアウトページに誘導
3. 決済完了後、コールバックURLに戻る
4. webhookでの支払い確認
5. ライセンス情報の更新

#### 6.2.3 Webhook処理

Stripeからのイベント通知を処理するWebhook実装。

**主要イベント処理:**
- `customer.subscription.created`
- `customer.subscription.updated`
- `customer.subscription.deleted`
- `invoice.payment_succeeded`
- `invoice.payment_failed`

**Webhook実装:**
- イベント検証（署名確認）
- イベントタイプに応じた処理振り分け
- 冪等性確保（重複処理防止）
- エラーハンドリングとリトライ

### 6.3 データ同期設計

外部システムとのデータ同期方式を詳細設計する。

#### 6.3.1 X.com データ同期

X.comとのデータ同期処理の詳細設計。

**同期項目:**
- 投稿データ
- エンゲージメント統計
- フォロワー情報
- アカウント情報

**同期スケジュール:**
- リアルタイム同期（投稿時）
- 定期同期（15分間隔でのエンゲージメントデータ更新）
- オンデマンド同期（ユーザーリクエスト時）
- バックグラウンド同期（アプリ起動時）

#### 6.3.2 Stripeデータ同期

Stripeとのデータ同期処理の詳細設計。

**同期項目:**
- サブスクリプション状態
- 支払い履歴
- 請求情報

**同期方式:**
- Webhookによるプッシュ通知（主要な方式）
- 定期ポーリング（バックアップとして）
- アプリ起動時の検証

## 7. セキュリティ設計

### 7.1 認証・認可設計

#### 7.1.1 ユーザー認証

アプリケーションへのアクセス制御を実現するユーザー認証の設計。

**認証方式:**
- ローカルアカウント認証（ユーザー名・パスワード）
- X.com OAuth認証（オプション）

**パスワード要件:**
- 最小8文字以上
- 英大文字・小文字・数字・特殊文字を含む
- bcryptによるハッシュ化（コストファクター12）

#### 7.1.2 ライセンス認証

有料プラン機能へのアクセスを制御するライセンス認証の設計。

**ライセンス検証:**
- ローカルライセンスファイル検証
- オンライン検証（Stripe APIでのサブスクリプション確認）
- ハードウェア固有識別子によるライセンス紐付け
- トライアルライセンス管理

**プラン機能制限:**
- 機能アクセス時のプラン確認
- UIコンポーネントの動的表示/非表示
- 機能利用量の制限（特定プランでの利用回数制限など）

### 7.2 データ保護設計

#### 7.2.1 保存データ暗号化

ローカルに保存される機密データの暗号化設計。

**暗号化対象:**
- OAuth認証トークン
- アカウント認証情報
- ユーザーパスワード（ハッシュ化）

**暗号化方式:**
- AES-256-GCM（認証付き暗号化）
- 環境変数とユーザー情報に基づく派生鍵
- ソルト付きKDF（Key Derivation Function）

#### 7.2.2 通信データ保護

外部サービスとの通信データ保護の設計。

**通信暗号化:**
- TLS 1.3以上の使用
- 証明書の検証
- 証明書ピンニング（主要サービス向け）

**API通信保護:**
- OAuthトークンの安全な管理
- トークンの自動リフレッシュ
- APIキーのメモリ内のみでの利用

### 7.3 プライバシー保護設計

#### 7.3.1 データ収集ポリシー

アプリケーションが収集するデータとその保護方針の設計。

**収集データ:**
- ユーザープロフィール情報
- 投稿内容
- 使用統計（匿名化）
- エラーログ（オプトイン）

**データ保護対策:**
- 明示的な同意の取得
- プライバシーポリシーの明確な提示
- データ収集のオプトアウトオプション
- 使用統計の匿名化

#### 7.3.2 データ削除ポリシー

ユーザーデータの削除に関するポリシー設計。

**データ削除機能:**
- アカウント削除機能
- 特定データの選択的削除
- 非アクティブアカウントの自動削除オプション

**バックアップポリシー:**
- バックアップからの完全削除
- 削除要求の記録と対応

## 8. 性能設計

### 8.1 リソース使用効率

アプリケーションのリソース使用効率を最適化するための設計。

**CPU使用最適化:**
- 重い処理のバックグラウンドスレッドへの移行
- マルチスレッド処理の適切な実装
- CPU負荷の監視と調整

**メモリ使用最適化:**
- 効率的なオブジェクトの再利用
- メモリリークの防止対策
- 大規模データセットの遅延ロード
- キャッシュサイズの動的調整

### 8.2 応答性とスケーラビリティ

アプリケーションの応答性と拡張性を確保するための設計。

**UI応答性:**
- 重い処理のバックグラウンド実行
- プログレスインジケータの適切な表示
- UIスレッドのブロッキング防止

**データ量対応:**
- 大量データの効率的なページング
- 検索とフィルタリングの最適化
- 古いデータの自動アーカイブ
- データベースインデックスの最適化

## 9. 運用設計

### 9.1 エラーハンドリング

アプリケーションのエラー処理と回復メカニズムの設計。

**エラー検出:**
- 例外の適切なキャッチと処理
- 入力値バリデーション
- API呼び出しエラー処理
- タイムアウト処理

**エラーレポート:**
- ログへの詳細記録
- エラースタック保存
- 開発者向け詳細情報
- ユーザー向けシンプルなエラーメッセージ
- オプトインでのクラッシュレポート送信

### 9.2 バックアップと復元

データの安全性を確保するためのバックアップ・復元機能の設計。

**バックアップメカニズム:**
- 自動定期バックアップ（24時間ごと）
- 手動バックアップオプション
- 差分バックアップによる効率化
- 設定と実データの分離バックアップ

**復元メカニズム:**
- フルバックアップからの復元
- 選択的データ復元
- 前回正常起動状態への復元
- バージョン間の互換性確保

### 9.3 ログとモニタリング

アプリケーションの動作状態を監視するためのログ記録とモニタリング設計。

**ログレベル:**
- ERROR: 重大なエラー（即時対応が必要）
- WARN: 注意が必要な状態
- INFO: 主要な操作や状態変化
- DEBUG: 開発者向け詳細情報（開発モードのみ）

**ログローテーション:**
- 日付ベースのログファイル分割
- 一定サイズでのログ分割
- 古いログの自動アーカイブ
- 長期保管ログの圧縮

## 10. 開発環境・言語・フレームワーク

### 10.1 開発環境

#### 10.1.1 IDE・ツール

- IntelliJ IDEA または Eclipse
- Scene Builder（JavaFX UI設計）
- Git（バージョン管理）
- Maven/Gradle（ビルドツール）
- SQLite Studio（データベース管理）

#### 10.1.2 テスト環境
- JUnit 5（単体テスト）
- TestFX（JavaFX UI自動テスト）
- Mockito（モック/スタブテスト）
- JaCoCo（コードカバレッジ）
- Selenium（必要に応じてブラウザ連携テスト）

#### 10.1.3 CI/CD環境

- GitHub Actions（CI/CD自動化）
- SonarQube（コード品質管理）
- Nexus/Artifactory（成果物リポジトリ）
- Docker（環境の標準化）

### 10.2 言語・ライブラリ

#### 10.2.1 プログラミング言語

- **Java 17** - コアアプリケーションの実装言語
- **SQL** - データベース操作
- **CSS** - UI スタイリング
- **JavaScript/ECMAScript** - 必要に応じてWebビュー内で使用

#### 10.2.2 フレームワーク・ライブラリ

- **JavaFX 17** - UIフレームワーク
- **FXML** - UI定義
- **SQLite-JDBC** - データベース接続
- **OkHttp** - HTTP通信
- **Jackson/Gson** - JSONパース
- **JUnit/TestFX** - テスト
- **Log4j 2** - ロギング
- **Stripe Java** - Stripe API連携
- **Twitter4J** - X.com API連携（必要に応じて）
- **ControlsFX** - 追加UI部品
- **jBCrypt** - パスワードハッシュ
- **BouncyCastle** - 暗号化
- **Apache POI** - Excelファイル操作（レポート用）
- **iText** - PDFファイル生成（レポート用）
- **JavaCPP** - ネイティブライブラリ連携

### 10.3 アプリケーションパッケージング

#### 10.3.1 ディストリビューション形式

- **Windows**: EXEインストーラ
- **macOS**: DMGイメージ
- **Linux**: DEBパッケージ

#### 10.3.2 パッケージング技術

- **jpackage** - プラットフォーム固有のパッケージ作成
- **jlink** - カスタムランタイムイメージ作成
- **Launch4j** - Windows EXEラッパー

#### 10.3.3 自動更新

- 起動時の更新チェック
- 差分更新のサポート
- バックグラウンド更新ダウンロード
- 次回起動時の自動適用

## 11. 付録

### 11.1 用語集

| 用語 | 説明 |
|------|------|
| X.com | 旧Twitter。短文テキストを中心としたソーシャルメディアプラットフォーム |
| エンゲージメント | いいね、リツイート、返信などのユーザーとのやり取り総称 |
| インプレッション | 投稿が表示された回数 |
| リーチ | 投稿を見たユニークユーザー数 |
| OAuth | 第三者アプリがユーザーに代わってAPIアクセスする認証プロトコル |
| API | Application Programming Interface。ソフトウェア間の通信手段 |

### 11.2 外部API参照

#### 11.2.1 X.com API

- API Base URL: https://api.twitter.com/2/
- 認証: OAuth 1.0a
- レート制限: 15分間隔でエンドポイント別の制限あり
- 主要ドキュメント: https://developer.twitter.com/en/docs/twitter-api

#### 11.2.2 Stripe API

- API Base URL: https://api.stripe.com/v1/
- 認証: APIキー認証
- 主要ドキュメント: https://docs.stripe.com/api
- 開発キー/本番キー分離

### 11.3 技術検証結果

#### 11.3.1 パフォーマンス検証

| コンポーネント | 測定指標 | 結果 | 許容基準 | 評価 |
|--------------|---------|------|---------|------|
| コンテンツ生成 | 処理時間 | 1.5秒 | 2.0秒以内 | 合格 |
| UI応答 | 応答時間 | 0.08秒 | 0.1秒以内 | 合格 |
| API通信 | 平均応答時間 | 0.9秒 | 2.0秒以内 | 合格 |
| データベース | 1000件検索時間 | 0.3秒 | 1.0秒以内 | 合格 |
| メモリ使用 | 起動時基本使用量 | 120MB | 200MB以内 | 合格 |

#### 11.3.2 技術選定根拠

| 技術要素 | 選定オプション | 採用決定 | 選定理由 |
|---------|--------------|----------|---------|
| UIフレームワーク | JavaFX/Electron/Qt | JavaFX | クロスプラットフォーム対応と既存Java資産活用 |
| データベース | SQLite/H2/Derby | SQLite | シンプルな構成、ゼロコンフィグ、広い普及率 |
| API通信ライブラリ | OkHttp/Apache HttpClient | OkHttp | モダンなAPI、使いやすさ、パフォーマンス |
| JSON処理 | Jackson/Gson/JSON-B | Gson | シンプルなAPI、十分な機能、軽量性 |

### 11.4 開発スケジュール

| フェーズ | 開始日 | 終了日 | 主要マイルストーン |
|---------|--------|-------|------------------|
| 要件定義 | 2025-04-01 | 2025-04-30 | 要件定義書承認 |
| 基本設計 | 2025-05-01 | 2025-05-31 | 基本設計書承認 |
| 詳細設計 | 2025-06-01 | 2025-06-30 | 詳細設計書承認 |
| 実装 | 2025-07-01 | 2025-08-15 | コード完成 |
| テスト | 2025-08-16 | 2025-09-15 | テスト完了 |
| リリース準備 | 2025-09-16 | 2025-09-30 | 正式リリース |

---

# Mavenプロジェクトの雛形作成
mvn archetype:generate -DgroupId=com.xcontent -DartifactId=xcontent-app -DarchetypeArtifactId=maven-archetype-quickstart -DinteractiveMode=false

# ディレクトリ移動
cd xcontent-app

# JavaFX用にsrc/main/java/com/xcontent/application/を作成し、MainApp.javaを配置
mkdir -p src/main/java/com/xcontent/application
mkdir -p src/main/resources
mkdir -p src/test/java


